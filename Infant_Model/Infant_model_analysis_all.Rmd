---
title: "Infection Timing Infant Models with Model analysis"
output:
  html_document:
    toc: true
    toc_depth: 2
    dev: 'svg'
---

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
library(ggplot2)
library(devtools)
library(gridExtra)
library(ggpubr)
library(data.table)
library(Metrics)
library(tidyverse)
library(GGally)

source("Infant_functions.R")
source("Infant_predict.R")
source("Infant_plotting.R")

knitr::opts_chunk$set(fig.width=16, fig.height=8)

```

```{r warning=FALSE, results='hide'}
# Set working directory
setwd("/Users/magdalenarussell/Documents/Matsen_group/infection-timing/Infant_Model")

# Load existing data
training_data = read.csv("../_ignore/AllRunsAvg.csv")
testing_data = read.csv("../_ignore/AllRunsAvg.csv")
```

The following plots show the models created for the data using an APD cutoff of 0.01. First you will see the actual time since infection versus APD regression (using the indicated new modelling strategy). Second you will see the relationship between the estimated time since infection and the actual time since infection. The perfect correlation (show as the blue spotted line) depicts the y = x line where actual time since infection = estimated time since infection. For these plots, I am showing a LM regression through the points with a confidence interval to show the trend of these estimated times. However, these estimated times were calculated using the indicated new modelling strategy (not always LM regression). Lastly, you will see the model statistics (i.e. model equation coefficients (also show on the plots in the form of an equation) and p values for each coefficient).

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LM_origin", "LAD", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 1, type = ty)
    plot_APD_TI_regression(together, apd = 1, type = ty)
    plot_ETI_TI_regression(together, apd = 1, type = ty)
    show_model_statistics(apd = 1, type= ty)
}
```

Here you will see the same plotting scheme except, now, the following plots show the models created for the data using an APD cutoff of 0.05.

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LM_origin", "LAD", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 5, type = ty)
    plot_APD_TI_regression(together, apd = 5, type = ty)
    plot_ETI_TI_regression(together, apd = 5, type = ty)
    show_model_statistics(apd = 5, type= ty)
}
```

Here, again, you will see the same plotting scheme except, now, the following plots show the models created for the data using an APD cutoff of 0.1.

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LM_origin", "LAD", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 10, type = ty)
    plot_APD_TI_regression(together, apd = 10, type = ty)
    plot_ETI_TI_regression(together, apd = 10, type = ty)
    show_model_statistics(apd = 10, type= ty)
}
```
Here are some plots that strive to get at model effectiveness and model selection. I think the major takeaways are that, almost universally, the fragment F3 and the apd cutoff of 1 show the most promising results for all models in terms of limiting error. 

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (apd in c(1, 5, 10)){
    for (ty in c("LM_origin", "LM", "LAD_origin", "LAD", "LM_GEE")){
        together = compile_data(train_data = training_data, new_data = testing_data, apd = apd, type = ty)
        plot_model_evaluation(together, apd = apd, type = ty)
    }
}
```

