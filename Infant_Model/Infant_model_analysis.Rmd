---
title: "Infant Infection Timing Models"
output: 
    html_document:
    toc: true
    toc_depth: 2
    dev: 'svg'

---

```{r echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
library(ggplot2)
library(devtools)
library(gridExtra)
library(ggpubr)
library(data.table)
library(Metrics)
library(tidyverse)
library(GGally)

source("Infant_functions.R")
source("Infant_predict.R")
source("Infant_plotting.R")

knitr::opts_chunk$set(fig.width=16, fig.height=8)

```

```{r warning=FALSE, results='hide'}
# Set working directory
setwd("/Users/magdalenarussell/Documents/Matsen_group/infection-timing/Infant_Model")

# Load existing data
training_data = read.csv("../_ignore/AllRunsAvg.csv")
testing_data = read.csv("../_ignore/AllRunsAvg.csv")
```

Note: for all of the following analyses, I have assigned the actual time since infection for all patients to be the midpoint of the third trimester (i.e. we are assigning birth to be time zero, so the actual infection time here is -0.125 years.)

The following plots show the models created for the data using an APD cutoff of 0.01. First you will see the actual time since infection versus APD regression (using the indicated new modelling strategy). You will see the model statistics below these plots (i.e. model equation coefficients (also show on the plots in the form of an equation) and p values for each coefficient). Second you will see the relationship between the estimated time since infection and the actual time since infection. The perfect correlation (show as the blue spotted line) depicts the y = x line where actual time since infection = estimated time since infection. For these plots, I am showing a LM regression through the points with a confidence interval to show the trend of these estimated times. However, these estimated times were calculated using the indicated new modelling strategy (not always LM regression). Lastly, you will see, again, a plot comparing the estimated time since infection and the actual time since infection. Here, the plots show the trends per individual. 

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LAD", "LM_origin", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 1, type = ty)
    plot_APD_TI_regression(together, apd = 1, type = ty)
    show_model_statistics(apd = 1, type= ty)
    plot_ETI_TI_regression(together, apd = 1, type = ty)
}
```

Here you will see the same plotting scheme except, now, the following plots show the models created for the data using an APD cutoff of 0.05.

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LAD", "LM_origin", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 5, type = ty)
    plot_APD_TI_regression(together, apd = 5, type = ty)
    show_model_statistics(apd = 5, type= ty)
    plot_ETI_TI_regression(together, apd = 5, type = ty)
}
```

Here, again, you will see the same plotting scheme except, now, the following plots show the models created for the data using an APD cutoff of 0.1.

```{r echo=TRUE, message=TRUE, warning=FALSE}
for (ty in c("LM", "LAD", "LM_origin", "LAD_origin", "LM_GEE")){
    together = compile_data(train_data = training_data, new_data = testing_data, apd = 10, type = ty)
    plot_APD_TI_regression(together, apd = 10, type = ty)
    show_model_statistics(apd = 10, type= ty)
    plot_ETI_TI_regression(together, apd = 10, type = ty)
}
```

